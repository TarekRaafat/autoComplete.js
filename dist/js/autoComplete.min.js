var a,b;a=this,b=function(){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e){return e.innerHTML=""}function h(t,e,n,i,s,r){i({event:t,query:e instanceof HTMLInputElement?e.value:e.innerHTML,matches:s.matches,results:s.list.map(function(e){return e.value}),selection:s.list.find(function(e){return 13===t.keyCode?e.index===Number(r.getAttribute(a)):"mousedown"===t.type?e.index===Number(t.target.getAttribute(a)):void 0})}),o(n)}function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}var a="data-id",n="autoComplete_list",l="autoComplete_result",t="autoComplete_highlighted",d="autoComplete_selected",s=function(e){return"string"==typeof e?document.querySelector(e):e()},r=function(e){var t=document.createElement(e.element);return t.setAttribute("id",n),e.container&&e.container(t),e.destination.insertAdjacentElement(e.position,t),t},u=function(e){return"<span class=".concat(t,">").concat(e,"</span>")},c=function(s,r,o){r.forEach(function(e,t){var n=document.createElement(o.element),i=r[t].index;n.setAttribute(a,i),n.setAttribute("class",l),o.content?o.content(e,n):n.innerHTML=e.match||e,s.appendChild(n)})},f=function(t,n,i,s){function r(e){c.classList.remove(d),a=1===e?c.nextSibling:c.previousSibling}function o(e){(c=e).classList.add(d)}var a,l=n.childNodes,u=l.length-1,c=void 0;t.onkeydown=function(e){if(0<l.length)switch(e.keyCode){case 38:c?(r(0),o(a||l[u])):o(l[u]);break;case 40:c?(r(1),o(a||l[0])):o(l[0]);break;case 13:c&&h(e,t,n,i,s,c)}},l.forEach(function(e){e.onmousedown=function(e){return h(e,t,n,i,s)}})},m=o;e.prototype=window.Event.prototype;var p={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||e,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})}};return function(){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.selector=e.selector||"#autoComplete",this.data={src:function(){return"function"==typeof e.data.src?e.data.src():e.data.src},key:e.data.key,cache:void 0===e.data.cache||e.data.cache},this.query=e.query,this.trigger={event:e.trigger&&e.trigger.event?e.trigger.event:["input"],condition:!(!e.trigger||!e.trigger.condition)&&e.trigger.condition},this.searchEngine="loose"===e.searchEngine?"loose":"function"==typeof e.searchEngine?e.searchEngine:"strict",this.threshold=e.threshold||0,this.debounce=e.debounce||0,this.resultsList={render:!(!e.resultsList||!e.resultsList.render)&&e.resultsList.render,view:e.resultsList&&e.resultsList.render?r({container:!(!e.resultsList||!e.resultsList.container)&&e.resultsList.container,destination:e.resultsList&&e.resultsList.destination?e.resultsList.destination:s(this.selector),position:e.resultsList&&e.resultsList.position?e.resultsList.position:"afterend",element:e.resultsList&&e.resultsList.element?e.resultsList.element:"ul"}):null,navigation:!(!e.resultsList||!e.resultsList.navigation)&&e.resultsList.navigation},this.sort=e.sort||!1,this.placeHolder=e.placeHolder,this.maxResults=e.maxResults||5,this.resultItem={content:!(!e.resultItem||!e.resultItem.content)&&e.resultItem.content,element:e.resultItem&&e.resultItem.element?e.resultItem.element:"li"},this.noResults=e.noResults,this.highlight=e.highlight||!1,this.onSelection=e.onSelection,this.init()}return function(e,t,n){t&&i(e.prototype,t),n&&i(e,n)}(t,[{key:"search",value:function(e,t){var n=t.toLowerCase();if("loose"===this.searchEngine){e=e.replace(/ /g,"");for(var i=[],s=0,r=0;r<n.length;r++){var o=t[r];s<e.length&&n[r]===e[s]&&(o=this.highlight?u(o):o,s++),i.push(o)}return s===e.length&&i.join("")}if(n.includes(e))return e=new RegExp("".concat(e),"i").exec(t),this.highlight?t.replace(e,u(e)):t}},{key:"listMatchedResults",value:function(n){var u=this;return new Promise(function(e){var l=[];n.filter(function(i,s){function e(e){var t=e?i[e]:i,n="function"==typeof u.searchEngine?u.searchEngine(u.queryValue,t):u.search(u.queryValue,t);n&&e?l.push({key:e,index:s,match:n,value:i}):n&&!e&&l.push({index:s,match:n,value:i})}if(u.data.key){var t=!0,n=!1,r=void 0;try{for(var o,a=u.data.key[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){e(o.value)}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}else e()});var t=u.sort?l.sort(u.sort).slice(0,u.maxResults):l.slice(0,u.maxResults);return e({matches:l.length,list:t})})}},{key:"ignite",value:function(){var a=this,l=s(this.selector);this.placeHolder&&l.setAttribute("placeholder",this.placeHolder);function t(t){Promise.resolve(a.data.cache?a.dataStream:a.data.src()).then(function(e){a.dataStream=e,function(t){function n(e,t){l.dispatchEvent(new p.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:e,input:i,query:s,matches:t?t.matches:null,results:t?t.list:null},cancelable:!0}))}var i=l instanceof HTMLInputElement?l.value.toLowerCase():l.innerHTML.toLowerCase(),s=a.queryValue=a.query&&a.query.manipulate?a.query.manipulate(i):i,e=a.resultsList.render,r=a.trigger.condition?a.trigger.condition(s):s.length>a.threshold&&s.replace(/ /g,"").length;if(e){var o=a.resultsList.view;m(o);r?a.listMatchedResults(a.dataStream,t).then(function(e){n(t,e),a.resultsList.render&&(0===e.list.length&&a.noResults?a.noResults():(c(o,e.list,a.resultItem),a.onSelection&&(a.resultsList.navigation?a.resultsList.navigation(t,l,o,a.onSelection,e):f(l,o,a.onSelection,e))))}):n(t)}else!e&&r&&a.listMatchedResults(a.dataStream,t).then(function(e){n(t,e)})}(t)})}this.trigger.event.forEach(function(e){l.addEventListener(e,function(n,i){var s;return function(){var e=this,t=arguments;clearTimeout(s),s=setTimeout(function(){return n.apply(e,t)},i)}}(function(e){return t(e)},a.debounce))})}},{key:"init",value:function(){var t=this;this.data.cache?Promise.resolve(this.data.src()).then(function(e){t.dataStream=e,t.ignite()}):this.ignite(),p.initElementClosestPolyfill()}}]),t}()},"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.autoComplete=b();
